#!/bin/bash
if [ -z "$ZEPHIRDIR" ]; then
  ZEPHIRDIR="%ZEPHIRDIR%"
  if [[ "$ZEPHIRDIR" == "%""ZEPHIRDIR""%" ]]; then
    if [ -h $0 ]; then
        REALPATH="`dirname $0`/`readlink $0`"
        CURDIR=`dirname $REALPATH`
    else
        CURDIR=`dirname $0`
    fi
    PARENTDIR=`cd $CURDIR/..; pwd`

    if [ -f $PARENTDIR/compiler.php ]; then
      export ZEPHIRDIR=$PARENTDIR
    else
      echo "Environment variable ZEPHIRDIR is not set"
      exit 1
    fi
  fi
fi

args[0]=$0
args+=("$@")
commands=(clean init builddev compile stubs fullclean version install build api help generate)

k=1
for ((i=1; i<=$#; i++)); do 
    for j in "${commands[@]}"; do
        if [[ "${args[${i}]}" == "$j" ]]; then
            k=$i
        fi
    done
done

php ${*:1:$k-1} $ZEPHIRDIR/compiler.php ${*:$k}
